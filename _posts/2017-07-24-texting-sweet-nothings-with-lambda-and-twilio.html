---
layout: post
title: Texting sweet nothings with Lambda and Twilio
date: '2017-07-24T17:00:23+09:00'
tags:
- lambda
- twilio
- sweet nothings
tumblr_url: https://blog.randylubin.com/post/163385970728/texting-sweet-nothings-with-lambda-and-twilio
---
<p>For Avital’s birthday, I wrote an app that texts her sweet messages several times per week – she loves it! I built it with Amazon Lambda and Twilio and it was pretty quick; I’ll walk you through it in this post.</p><figure data-orig-width="750" data-orig-height="439" class="tmblr-full"><img src="https://66.media.tumblr.com/ecef0c76f468267fa84e4cd5f742f5c9/tumblr_inline_otmckxl2MM1qc3e3u_540.png" alt="image" data-orig-width="750" data-orig-height="439"/></figure><h2>Tech Stack Overview</h2><p>The app has is built on two services, Amazon Lambda and Twilio.</p><p><a href="https://aws.amazon.com/lambda/" target="_blank">Lambda</a> is part of Amazon Web Services (AWS) and allows you to run a short snippet of code on demand – this is much better than the alternative of maintaining a server just to run an app a few times per day. You can sign up for a <a href="https://aws.amazon.com/free/" target="_blank">free AWS account</a> which should more than cover your Lambda usage.</p><p><a href="https://www.twilio.com/" target="_blank">Twilio</a> is platform that allows you to easily integrate your code with SMS, voice calls, and other telecommunications infrastructure. For this app, we’ll only use their texting. You can try it for free but you’ll want to upgrade to their paid version once you’re ready to share it with your partner. It’s cheap though: $0.0075 per text message plus $1 per month for the phone number.<br/></p><h2>Setting up Lambda and Twilio</h2><p>I followed <a href="https://www.twilio.com/blog/2017/05/send-sms-text-messages-aws-lambda-python-3-6.html" target="_blank">this guide</a> to get the initial Lambda and Twilio integration working. The guide is well written and has photos to guide you through the process. I didn’t have any issues getting an initial text sent to my phone.</p><p>Once I had their integration working, I customized my code to send out sweet messages to my fiancée. You can see my updated code in <a href="https://www.twilio.com/blog/2017/05/send-sms-text-messages-aws-lambda-python-3-6.html" target="_blank">this GitHub Gist</a>. Feel free to copy and past it into Lambda and overwrite the Twilio code.</p><p>The key functionality is in 24-36, where you can write a list of messages and a list of sign-offs (signatures). Line 36 randomly assembles the body of the text from the two lists. Having a great list of messages is key to having your partner like the app!</p><blockquote><p>   # add your own sweet nothings to this array<br/>    message_list = [<br/>      &quot;I love you!&ldquo;,<br/>      &quot;I am so lucky to have you in my life!&rdquo;<br/>    ]<br/><br/>    # put your own name, sign-offs, pet names in this list<br/>    sign_off_list = [<br/>      &quot;Randy&quot;,<br/>      &quot;Fiance&quot;<br/>    ]<br/><br/>    body = random.choice(message_list) + &ldquo; -&rdquo; + random.choice(sign_off_list)<br/></p></blockquote><p>Another significant change is the addition of environmental variables MY_NUMBER and PARTNERS_NUMBER. These are custom environmental variables that you’ll add on the Lambda page (below the code) just like you added the Twilio Auth Token and account ID. MY_NUMBER is the custom phone number that you have from Twilio and PARTNERS_NUMBER is your partner’s real personal phone number (or your personal number while you test the app). The format should be +15554442233 – don’t forget the `+1` and don’t use any quotation marks.</p><p>The final addition of note is the variable send_this_time which is randomly assigned to be true or false. I added this because I wanted some randomness around how often the script would send the text. You can play with the number to change the probability of the message sending. When you’re testing the code you can just set the variable to <b>True</b> so that it sends every time.</p><p>The final bit of setup is to instruct Lambda how often to trigger the script; here are the steps:</p><ol><li>Go to the Triggers Tab and click <b>Add trigger</b></li><li>Select CloudWatch Events</li><li>Select Add a New Rule and make up a name and description for your script</li><li>Add a Schedule Expression - this is the key step and there are further details below</li><li>Submit the Trigger</li></ol><p>Here’s a screenshot of the instructions filled out:</p><figure data-orig-width="922" data-orig-height="648" class="tmblr-full"><img src="https://66.media.tumblr.com/5e3280cad3ff90fedca845fba1716c02/tumblr_inline_otmd9wMPgi1qc3e3u_540.png" alt="image" data-orig-width="922" data-orig-height="648"/></figure><p><br/></p><p>Schedule expressions can be rates (e.g. once per day) or for Crons (time based instructions. I used the expression cron(0 17-0 * * ? *) which runs the script once per hour during the work day (pacific time). You can learn more about scheduling events with Lambda on <a href="https://docs.aws.amazon.com/lambda/latest/dg/tutorial-scheduled-events-schedule-expressions.html" target="_blank">this Amazon page</a>. It may take some trial and error to get the time zone right. Be aware, this controls how often the script runs but if you are using the send_this_now randomization, it won’t send every time. With the send_this_now frequency at 0.075, it sends a message - on average - about four times per week. </p><p>With the Cron Trigger set, Lambda will start executing the script and your partner should start getting texts. A few additional notes:</p><ul><li>Test with your own phone number to make sure everything works smoothly<br/></li><li>You need to add verify your partner’s number with Twilio<br/></li><li>Save the number in your partner’s contacts with something nice – I renamed it to <i>Sweet Nothings from Randy</i><br/></li><li>Keep adding content to the message array so there’s always something new being sent</li></ul><p>Good luck and let me know if you have any issues!</p>
